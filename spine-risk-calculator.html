<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine Surgery ICU Risk Calculator</title>
    <style>
        body {
            font-family: Georgia, 'Times New Roman', Times, serif;
            background-color: #f4f6f8;
            /* Soft clinical gray-blue */
            color: #333333;
            line-height: 1.6;
            margin: 0;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            border: none;
            border-radius: 8px;
            /* Soft corners */
            padding: 50px;
            background: #ffffff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            /* Elegant shadow */
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 30px;
        }

        h1 {
            color: #003366;
            font-size: 28px;
            margin-bottom: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .description {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 15px;
            color: #555;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .section-box {
            background: #ffffff;
            border: 1px solid #eef0f2;
            border-left: 4px solid #003366;
            /* Accent bar */
            border-radius: 4px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            /* Subtle lift */
            transition: transform 0.2s ease;
        }

        .section-box:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.06);
        }

        /* Icon styling */
        .icon {
            width: 26px;
            height: 26px;
            fill: #003366;
            vertical-align: text-bottom;
            margin-right: 12px;
            opacity: 0.9;
        }

        h2.section-title {
            color: #003366;
            font-size: 19px;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 12px;
            margin-top: 0;
            margin-bottom: 25px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            align-items: center;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            color: #666;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #dde1e5;
            border-radius: 4px;
            font-family: inherit;
            font-size: 15px;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: #fdfdfd;
        }

        input:focus {
            border-color: #003366;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
            background: #fff;
        }

        /* CCI Checklist Styling */
        .cci-checklist {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #eee;
        }

        .cci-item {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .cci-item:hover {
            color: #003366;
        }

        .cci-item input {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            accent-color: #003366;
            cursor: pointer;
        }

        .cci-total {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-weight: 700;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #003366;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #cci-display {
            font-size: 20px;
            background: #e8f0fe;
            padding: 2px 10px;
            border-radius: 12px;
        }

        .btn-calculate {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 51, 102, 0.2);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .btn-calculate:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(0, 51, 102, 0.25);
        }

        .btn-calculate:active {
            transform: translateY(1px);
        }

        /* Result Panel */
        #result-panel {
            display: none;
            margin-top: 50px;
            padding: 40px;
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .risk-label {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-score {
            font-size: 64px;
            font-weight: 700;
            color: #003366;
            margin: 20px 0;
            font-family: Georgia, serif;
            line-height: 1;
        }

        .interpretation {
            font-size: 16px;
            max-width: 650px;
            margin: 20px auto 0;
            color: #444;
            line-height: 1.6;
        }

        .disclaimer {
            margin-top: 60px;
            font-size: 13px;
            color: #888;
            text-align: center;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>Spine Surgery Complication Risk Calculator</h1>
            <div class="description">
                This tool predicts the probability of 72-hour postoperative complications (Acute Kidney Injury,
                Mechanical Ventilation, or Mortality) using granular physiologic and laboratory data from the first 24
                hours of ICU admission. The model was developed and validated using the MIMIC-IV database (Prempeh et
                al.).
            </div>
        </header>

        <form id="riskForm">
            <!-- Demographics -->
            <div class="section-box">
                <h2 class="section-title">
                    <!-- User/Patient Icon -->
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    Demographics & Clinical History
                </h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="age">Age (years)</label>
                        <input type="number" id="age" name="age" placeholder="e.g. 65" required>
                    </div>
                    <div class="form-group">
                        <label for="sex">Sex</label>
                        <select id="sex" name="sex">
                            <option value="0">Female</option>
                            <option value="1">Male</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="margin-bottom: 10px;">Charlson Comorbidity Index (Select all that apply):</label>
                    <div class="cci-checklist">
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Myocardial
                            Infarction</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Congestive Heart
                            Failure</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Peripheral Vascular
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Cerebrovascular
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Dementia</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Chronic Pulmonary
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Connective Tissue
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Peptic Ulcer
                            Disease</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Mild Liver
                            Disease</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="1"> Diabetes
                            (uncomplicated)</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Diabetes (end-organ
                            dmg)</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Hemiplegia</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Mod/Severe Renal
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Any Tumor</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Leukemia</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="2"> Lymphoma</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="3"> Mod/Severe Liver
                            Dis.</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="6"> Metastatic Solid
                            Tumor</label>
                        <label class="cci-item"><input type="checkbox" class="cci-check" value="6"> AIDS</label>
                    </div>
                    <div class="cci-total">
                        <span>Calculated CCI Score:</span>
                        <span id="cci-display">0</span>
                        <input type="hidden" id="cci" value="0">
                    </div>
                </div>
            </div>

            <!-- 24h Vitals -->
            <div class="section-box">
                <h2 class="section-title">
                    <!-- Heart/Vitals Icon -->
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                    </svg>
                    24-Hour Post-Op Vitals (Means)
                </h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="hr">Heart Rate (bpm)</label>
                        <input type="number" id="hr" name="hr" placeholder="Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="map">Mean Arterial Pressure (mmHg)</label>
                        <input type="number" id="map" name="map" placeholder="Mean" required>
                    </div>
                    <div class="form-group">
                        <label for="spo2">Oxygen Saturation (%)</label>
                        <input type="number" id="spo2" name="spo2" placeholder="Mean" required max="100">
                    </div>
                    <div class="form-group">
                        <label for="rr">Respiratory Rate (breaths/min)</label>
                        <input type="number" id="rr" name="rr" placeholder="Mean" required>
                    </div>
                </div>
            </div>

            <!-- 24h Labs -->
            <div class="section-box">
                <h2 class="section-title">
                    <!-- Microscope/Labs Icon -->
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M6 22h12a1 1 0 001-1v-4l-3-4V4h1a1 1 0 100-2H7a1 1 0 100 2h1v9l-3 4v4a1 1 0 001 1zm4-16h4v7.5l2 2.66V20H8v-3.84l2-2.66V6z" />
                    </svg>
                    24-Hour Laboratory Values
                </h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="creat">Creatinine (mg/dL) - MAX</label>
                        <input type="number" id="creat" name="creat" step="0.1" placeholder="Max" required>
                    </div>
                    <div class="form-group">
                        <label for="hgb">Hemoglobin (g/dL) - MIN</label>
                        <input type="number" id="hgb" name="hgb" step="0.1" placeholder="Min" required>
                    </div>
                    <div class="form-group">
                        <label for="sodium">Sodium (mEq/L) - MIN</label>
                        <input type="number" id="sodium" name="sodium" placeholder="Min" required>
                    </div>
                    <div class="form-group">
                        <label for="potassium">Potassium (mEq/L) - MAX</label>
                        <input type="number" id="potassium" name="potassium" step="0.1" placeholder="Max" required>
                    </div>
                    <div class="form-group">
                        <label for="bicarb">Bicarbonate (mEq/L)</label>
                        <input type="number" id="bicarb" name="bicarb" placeholder="Lowest" required>
                    </div>
                    <div class="form-group">
                        <label for="platelets">Platelets (x10^9/L)</label>
                        <input type="number" id="platelets" name="platelets" placeholder="Min" required>
                    </div>
                    <div class="form-group">
                        <label for="inr">INR (Max)</label>
                        <input type="number" id="inr" name="inr" step="0.1" placeholder="Max" required>
                    </div>
                </div>
            </div>

            <!-- Inputs/Outputs -->
            <div class="section-box">
                <h2 class="section-title">
                    <!-- IV Bag/Fluid Icon -->
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M21 3h-6.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H3v18c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3zM12 3c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V5h14v16zm-8-6h2v4h-2zm-3 2h2v2H8zm6 0h2v2h-2z" />
                    </svg>
                    Fluid Balance (24h)
                </h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="fluid_in">Total Fluid Input (mL)</label>
                        <input type="number" id="fluid_in" name="fluid_in" placeholder="Total" required>
                    </div>
                    <div class="form-group">
                        <label for="urine_out">Total Urine Output (mL)</label>
                        <input type="number" id="urine_out" name="urine_out" placeholder="Total" required>
                    </div>
                </div>
            </div>

            <button type="button" class="btn-calculate" onclick="calculateRisk()">Calculate Risk Probability</button>
        </form>

        <div id="result-panel">
            <h2 class="section-title" style="text-align: center; border: none; justify-content: center;">
                <svg class="icon" viewBox="0 0 24 24" style="fill: #003366;">
                    <path
                        d="M9 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zm6 0c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-.29.02-.58.05-.86 2.36-1.05 4.23-2.98 5.21-5.37C11.07 8.33 14.05 10 17.42 10c.78 0 1.53-.09 2.25-.26.21 1.01.33 2.05.33 3.14 0 4.41-3.59 8-8 8z" />
                </svg>
                Predicted 72-Hour Complication Probability
            </h2>
            <div id="riskLabel" class="risk-label" style="background: #eee; border: 1px solid #ccc;">Processing...</div>
            <div id="riskValue" class="risk-score">--%</div>
            <p class="interpretation">
                <strong>Interpretation:</strong> This patient falls into the <span id="riskTierText">--</span> risk
                category based on the logistic regression model validated in <em>Prempeh et al.</em>
            </p>
        </div>

        <div class="disclaimer">
            <strong>Disclaimer:</strong> This tool is intended for research and educational purposes only. It implements
            the predictive model described in "Development of Machine and Deep Learning Models for Early Prediction of
            ICU Complications Following Spine Surgery". It has not been externally validated for prospective clinical
            decision making. Do not use this tool as the sole basis for clinical management.
        </div>
    </div>

    <script>
        // CCI Calculator Logic
        const checkboxes = document.querySelectorAll('.cci-check');
        const cciDisplay = document.getElementById('cci-display');
        const cciInput = document.getElementById('cci');

        function updateCCIScore() {
            let score = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    score += parseInt(cb.value);
                }
            });
            cciDisplay.textContent = score;
            cciInput.value = score;
        }

        checkboxes.forEach(cb => {
            cb.addEventListener('change', updateCCIScore);
        });

        function calculateRisk() {
            // 1. Get Values
            const age = parseFloat(document.getElementById('age').value) || 0;
            const sex = parseFloat(document.getElementById('sex').value) || 0;
            // Get CCI from the computed hidden input
            const cci = parseFloat(document.getElementById('cci').value) || 0;

            const hr = parseFloat(document.getElementById('hr').value) || 0;
            const map = parseFloat(document.getElementById('map').value) || 0;
            const spo2 = parseFloat(document.getElementById('spo2').value) || 0;
            const rr = parseFloat(document.getElementById('rr').value) || 0;

            const creat = parseFloat(document.getElementById('creat').value) || 0;
            const hgb = parseFloat(document.getElementById('hgb').value) || 0;
            const sodium = parseFloat(document.getElementById('sodium').value) || 0;
            const potassium = parseFloat(document.getElementById('potassium').value) || 0;
            const bicarb = parseFloat(document.getElementById('bicarb').value) || 0;
            const platelets = parseFloat(document.getElementById('platelets').value) || 0;
            const inr = parseFloat(document.getElementById('inr').value) || 0;

            const fluid_in = parseFloat(document.getElementById('fluid_in').value) || 0;
            const urine_out = parseFloat(document.getElementById('urine_out').value) || 0;

            // 2. Normalize (Z-score) - Placeholder Stats
            const stats = {
                age: { mean: 60.6, std: 15.5 },
                cci: { mean: 4.1, std: 3.1 },
                hr: { mean: 85, std: 15 },
                map: { mean: 80, std: 12 },
                spo2: { mean: 97, std: 2 },
                rr: { mean: 18, std: 4 },
                creat: { mean: 1.0, std: 0.5 },
                hgb: { mean: 10.5, std: 1.5 },
                sodium: { mean: 139, std: 3 },
                potassium: { mean: 4.0, std: 0.5 },
                bicarb: { mean: 24, std: 3 },
                platelets: { mean: 200, std: 80 },
                inr: { mean: 1.2, std: 0.3 },
                fluid_in: { mean: 2500, std: 1000 },
                urine_out: { mean: 1500, std: 800 }
            };

            const z = (val, key) => (val - stats[key].mean) / stats[key].std;

            // 3. Coefficients (Log-Odds) - Placeholder Weights
            let logOdds = -2.5; // Intercept 

            logOdds += z(age, 'age') * 0.1;
            logOdds += sex * 0.2;
            logOdds += z(cci, 'cci') * 0.1;

            logOdds += z(creat, 'creat') * 0.5;
            logOdds += z(spo2, 'spo2') * -0.5;
            logOdds += z(sodium, 'sodium') * -0.2;
            logOdds += z(hgb, 'hgb') * -0.2;

            logOdds += z(hr, 'hr') * 0.05;
            logOdds += z(map, 'map') * -0.05;
            logOdds += z(rr, 'rr') * 0.05;
            logOdds += z(potassium, 'potassium') * 0.03;
            logOdds += z(inr, 'inr') * 0.1;

            // 4. Probability
            const probability = 1 / (1 + Math.exp(-logOdds));
            const percent = (probability * 100).toFixed(1);

            // 5. Display
            const resultPanel = document.getElementById('result-panel');
            const riskLabel = document.getElementById('riskLabel');
            const riskValue = document.getElementById('riskValue');
            const riskTierText = document.getElementById('riskTierText');

            resultPanel.style.display = 'block';
            riskValue.innerText = percent + "%";

            // Style Update
            if (percent < 20) {
                riskLabel.innerText = "LOW RISK (<20%)";
                riskLabel.style.backgroundColor = "#e8f5e9";
                riskLabel.style.color = "#1b5e20";
                riskLabel.style.border = "1px solid #c8e6c9";

                riskTierText.innerText = "LOW";
                riskTierText.style.color = "#1b5e20";
            } else if (percent < 40) {
                riskLabel.innerText = "MODERATE RISK (20-40%)";
                riskLabel.style.backgroundColor = "#fff3e0";
                riskLabel.style.color = "#e65100";
                riskLabel.style.border = "1px solid #ffe0b2";

                riskTierText.innerText = "MODERATE";
                riskTierText.style.color = "#e65100";
            } else {
                riskLabel.innerText = "HIGH RISK (>40%)";
                riskLabel.style.backgroundColor = "#ffebee";
                riskLabel.style.color = "#b71c1c";
                riskLabel.style.border = "1px solid #ffcdd2";

                riskTierText.innerText = "HIGH";
                riskTierText.style.color = "#b71c1c";
            }

            resultPanel.scrollIntoView({ behavior: "smooth" });
        }
    </script>

</body>

</html>